<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Reveal.js 3 Slide Demo</title>
    <link rel="stylesheet" href="reveal.js/css/reveal.css">
    <link rel="stylesheet" href="reveal.js/css/theme/sky.css" id="theme">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <script type="text/javascript" language="javascript" src="http://code.jquery.com/jquery-1.11.3.min.js"></script>

    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-size: 16px;
            font-family: "Segoe UI light", Segoe, 'Segoe WP', "Lucida Grande", "Lucida Sans", Tahoma, Verdana, Arial, sans-serif;
            /*background: linear-gradient(to right, gray, white);*/
        }

        .venntooltip {
            position: absolute;
            text-align: center;
            width: 128px;
            height: 28px;
            background: #333;
            color: #ddd;
            padding: 2px;
            border: 0px;
            border-radius: 8px;
            opacity: 0;
            font-size: 16px;
        }

        .vennContainer {
            text-align: center;
            font-size: 16px;
        }

        .group:after {
            content: "";
            display: table;
            clear: both;
        }

        #dateSlider {
            width: 100%;
        }
    </style>

</head>

<body>
    <!-- Wrap the entire slide show in a div using the "reveal" class. -->
    <div class="reveal">
        <!-- Wrap all slides in a single "slides" class -->
        <div class="slides">

            <!-- ALL SLIDES GO HERE -->
            <!-- Each section element contains an individual slide -->
            <!-- SLIDE 1 -->
            <section>
                <p>Venn Diagram!!</p>
                <div id="wrapper" class="group">

                    <div id="block-right" class="column">

                        <div id="block-right-bottom">
                            <div class="controlHolder" id="slider">
                                <p id="subTitle"></p>
                                <input id="dateSlider" type=range multiple step="1" min="0" max="1" value="0" list="ticMarks"><datalist id="ticMarks"></datalist>
                            </div>
                            <div class="controlHolder" id="stepButtons">
                                <input type="button" id="prevDataSet" value="  <<  " />
                                <input type="button" id="nextDataSet" value="  >>  " />
                            </div>
                        </div>
                    </div>
                    <div id="block-left" class="column">
                        <div class="vennContainer" id="venn"></div>
                    </div>

                </div>

                <div class="buttonHolder" id="stepCuttons"></div>
            </section>

            <!-- SLIDE 2 -->
            <section>
                <h1>About My Product</h1>
                <p>My product discussed here</p>
            </section>

            <!-- SLIDE 3 -->
            <section id="show-a-link">
                <h1>Show a live link</h1>
                <p>Slide 2 discussed here</p>
                <p>See <a href="http://www.htmlcheats.com">HTMLCheats.com</a></p>
            </section>

            <!-- SLIDE 4 -->
            <section>
                <h1>Slide 3</h1>
                <p>How does one revisit an arbitrary slide in code?</p>
                <p>Visit internal slide<a href="#/show-a-link"> 2</a>
            </section>






        </div>
    </div>
    <script src="reveal.js/lib/js/head.min.js"></script>
    <script src="reveal.js/js/reveal.js"></script>

    <script>
        // Required, even if empty.
        Reveal.initialize({

        });
    </script>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="./venn.js"></script>
    <script src="./data.js"></script>

    <script>

        // setup slider

        var sliderMax = 0;
        var sliderMin = 99999999999999;
        var newOption;
        var sliderTicMarks = document.getElementById("ticMarks");
        var newDate;
        var dates = [];
        var dateString;
        for (i = 0; i < sets.length; i++) {
            dateString = sets[i]["date"].split("-");

            newDate = (new Date(dateString[0], dateString[1], dateString[2])).getTime();
            dates.push(newDate);

            newOption = document.createElement("option");
            newOption.setAttribute("value", newDate);
            sliderTicMarks.appendChild(newOption);
            sliderMin = (newDate < sliderMin) ? newDate : sliderMin;
            sliderMax = (newDate > sliderMax) ? newDate : sliderMax;
            firstDate = (i == 0) ? firstDate = newDate : null;
        }
        var slider = document.getElementById("dateSlider");
        slider.value = dates[0];
        slider.max = sliderMax;
        slider.min = sliderMin;

        var count = 0;

        ////INPUTS

        // keyboard: space bar
        document.body.onkeyup = function (e) {
            var k = e.keyCode;
            // go forward if it's spacebar or right arrow
            if (k == 32 || k == 39) {
                goForward();
            }
            else if (k == 37) {
                goBack();
            }
        }

        // previous button
        $(function () {
            $('#prevDataSet').click(function () {
                goBack();
            });
        });

        // next button
        $(function () {
            $('#nextDataSet').click(function () {
                goForward();
            });
        });

        // move back 1 dataset
        function goBack() {
            count = count - 1;
            if (count < 0) count = sets.length - 1;
            updateContent();
        }

        // move forward 1 dataset
        function goForward() {
            count = count + 1;
            if (count > 0) count = count % sets.length;
            updateContent();
        }

        // call to update everything on screen
        function updateContent() {
            chart = buildVennDiagram();
            div.datum(sets[count].data).call(chart);
            //document.getElementById("annotationText").innerHTML = sets[count].text;
            document.getElementById("dateSlider").value = dates[count];
            document.getElementById("subTitle").innerHTML = sets[count].date;
        }

        function buildVennDiagram() {
            return venn.VennDiagram()
                         .width(window.innerWidth/2)
                         .height(window.innerHeight/3);

        }

        // Venn Diagram Stuff
        var chart = buildVennDiagram();

        var div = d3.select("#venn");

        // initialize
        updateContent();

        window.addEventListener("resize", updateContent);

        // Tooltip to show section counts
        var tooltip = d3.select("body").append("div")
            .attr("class", "venntooltip");

        div.selectAll("path")
            .style("stroke-opacity", 0)
            .style("stroke", "#fff")
            .style("stroke-width", 0)

        div.selectAll("g")
            .on("mouseover", function (d, i) {
                // sort all the areas relative to the current item
                venn.sortAreas(div, d);

                // Display a tooltip with the current size
                tooltip.transition().duration(400).style("opacity", .9);
                tooltip.text(d.size + " users");

                // highlight the current path
                var selection = d3.select(this).transition("tooltip").duration(400);
                selection.select("path")
                    .style("stroke-width", 3)
                    .style("fill-opacity", d.sets.length == 1 ? .4 : .1)
                    .style("stroke-opacity", 1);
            })

            .on("mousemove", function () {
                tooltip.style("left", (d3.event.pageX) + "px")
                       .style("top", (d3.event.pageY - 28) + "px");
            })

            .on("mouseout", function (d, i) {
                tooltip.transition().duration(400).style("opacity", 0);
                var selection = d3.select(this).transition("tooltip").duration(400);
                selection.select("path")
                    .style("stroke-width", 0)
                    .style("fill-opacity", d.sets.length == 1 ? .25 : .0)
                    .style("stroke-opacity", 0);
            });

    </script>



</body>
</html>
